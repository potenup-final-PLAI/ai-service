### 🔗 전투 AI 시스템 - LangGraph 기반 처리 흐름

전투 시 몬스터는 상황을 인식하고, AI를 통해 다음 행동을 결정합니다. 이 과정은 LangGraph를 활용하여 **단계별로 처리 흐름을 분리**하고, 필요 시 분기 처리를 통해 **행동 다양성을 확보**합니다.

---

### 🧩 처리 단계 요약

1. **상황 판단**
    - 몬스터 상태, 전투 상황(턴 수, 플레이어 상태 등)을 기반으로
    - 현재 위험 수준을 판단 (예: 낮음 / 중간 / 높음)
2. **행동 유형 결정**
    - 판단된 위험 수준에 따라 AI가 행동 유형을 결정
    - 예: 공격, 회복, 도망, 대기 등
3. **타겟 결정**
    - 공격 또는 회복 등 대상이 필요한 경우
    - 타겟으로 삼을 플레이어나 대상 유닛을 결정
4. **최종 행동 생성**
    - 앞 단계 결과를 종합하여
    - 실제 행동 명령(JSON 형태 등)을 생성 및 반환

---

### 🔀 분기 처리 도입 지점

- **상황 판단 결과에 따라 다른 행동 결정 흐름으로 분기 가능**
    
    예: 위험 수준이 높으면 방어형 전략, 낮으면 공격형 전략 노드로 분기
    
- **행동 유형에 따라 타겟 결정 단계를 생략하거나 분기 가능**
    
    예: `retreat`는 타겟이 필요 없어 바로 행동 생성 단계로 이동
    

---

### 🧠 활용 효과

- **행동 흐름이 명확하게 분리되어 유지보수 및 테스트 용이**
- **상황별 전략 분기 적용 가능 (다양한 몬스터 AI 연출)**
- **LLM의 응답 구조를 단순화하고 단계별 응답 품질 관리 가능**

## LangGraph 도입에 따른 시스템 구조 개선 정리

---

### 🔹 결정 흐름 구조화

- 행동 판단 과정을 노드 단위로 분리 (예: 이동 판단 → 경로 탐색 → 스킬 선택)
- 판단 단계별 개별 실행 및 테스트 가능
- 판단 실패 또는 오류 발생 시 해당 노드 단독 교체 또는 Fallback 처리 용이

---

### 🔹 조건 분기 처리 유연화

- 사거리 외 적 존재 시 → 이동 노드 분기
- AP 부족 시 → 대기 노드 또는 턴 종료로 분기
- 상태 이상 발생 시 → 상태 기반 판단 노드 연결 가능
- 분기 흐름 시각화 및 로직 트레이싱 가능

---

### 🔹 유지보수 및 확장성 강화

- 전략적 판단 로직을 노드 단위로 구성 → 기능 단위 추가 및 제거 용이
- 캐릭터 성향 기반 전략 흐름 (공격형, 방어형 등) 노드 재조합 가능
- 테스트 및 디버깅 시 특정 단계만 단독 실행 가능

---

### 🔹 추론 흐름의 투명성 확보

- 노드별 입력/출력 기록 가능
- 판단 과정 로그 및 행동 이유 저장 가능
- 플레이어 대상 전투 판단 설명 제공
- 정확한 AI 의사결정 문제 진단 가능 (내부 분석 및 리플레이 활용)

---

### 🔹 기대 효과

- 유연한 전투 흐름 설계
- AI 행동 판단의 정확도 향상
- 유지보수 효율성 증대
- 전략형 AI 시스템으로 확장 가능